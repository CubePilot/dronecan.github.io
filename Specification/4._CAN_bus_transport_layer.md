---
---

# CAN bus transport layer

## The concept of transfer

*Transfer* is a momentary act of data transmission between nodes.
A transfer that is addressed to all nodes except the source node is a *broadcast transfer*.
A transfer that is addressed to one particular node is a *unicast transfer*.
UAVCAN defines the following kinds of transfers:

* Message transfer - a broadcast transfer that contains a serialized message.
* Service transfer - a unicast transfer that contains either a service request or a service response.

Both message and service transfers can be further distinguished between:

* Single-frame transfer - a transfer that is entirely contained in a single CAN frame.
* Multi-frame transfer - a transfer whose payload is distributed over multiple CAN frames.

The following properties are common to all kinds of transfer:

Property        | Description
----------------|------------------------------------------------------------------------------------------------------
Payload         | The serialized data structure
Data type ID    | This identifier indicates how the data structure should be interpreted
Priority        | See below
Transfer ID     | An integer value that allows receiving nodes to distinguish this transfer from others

The transfer priority is an integer number that defines the urgency of the data contained in the transfer.
Numerically lower priority values indicate higher urgency, and humerically higher values indicate lower urgency.
Transfers of higher priority (i.e. with numerically lower priority value) can delay transmission of transfers
whose priority are lower (i.e. numerically higher).

### Message broadcasting

A broadcasted message is represented by a single message transfer that contains the serialized message.
A broadcasted message has the following properties:

Property        | Description
----------------|------------------------------------------------------------------------------------------------------
Payload         | The serialized message
Data type ID    | This identifier indicates how the message should be interpreted
Source node ID  | Node ID of the node that has transmitted the transfer
Priority        | See above
Transfer ID     | See above

In order to broadcast a message, the broadcasting node must have a node ID that is unique within the network.
An exception is applied to *anonymous message transfers*.

#### Anonymous message broadcasting

Anonymous message is a message that originates from a node that doesn't have a node ID.
This sort of message transfer is useful for dynamic node ID allocation purposes - a high-level concept that
will be explained in the following parts of the specification.

An anonymous message has the same properties as a regular message, except for source node ID.

Note that anonymous messages require specific arbitration rules and have restrictions on the acceptable
data type ID values.
The details are explained in the following chapters.

#### Timing

Message transmission should be aborted if it could not be completed in 1 second or less.

### Service invocation

A service invocation consists of two service transfers:

1. *Service request transfer* - from the node that invokes the service, known as *client*, to the node that provides
the service, known as *server*.
2. *Service response transfer* - once the server node receives the service request and processes it, it sends a
response transfer back to the client.

A service request transfer has the following properties:

Property                | Description
------------------------|------------------------------------------------------------------------------------------------------
Payload                 | The serialized request structure
Data type ID            | This identifier indicates how the request should be interpreted
Source node ID          | Node ID of the client
Destination node ID     | Node ID of the server
Priority                | See above
Transfer ID             | An integer value that serves two purposes: 1. allows the server to distinguish this request from other requests from the same client; 2. allows the client to match the response with request

A service response transfer has the following properties:

Property                | Description
------------------------|------------------------------------------------------------------------------------------------------
Payload                 | The serialized response structure
Data type ID            | Must be the same value as in the request transfer
Source node ID          | Node ID of the server
Destination node ID     | Node ID of the client
Priority                | Should be the same value as in the request transfer
Transfer ID             | Must be the same value as in the request transfer

Both client and server must have node ID values that are unique within the network.

#### Timing

The following timings should be used, unless the application strongly requires different values:

* Service transfer transmission should be aborted if it could not complete in 0.5 seconds.
* The client should stop waiting for response from the server if the response did not arrive in 0.5 seconds.
* The server should be able to process any request in under 0.25 seconds.

If different values are used, they must be explicitly documented.


